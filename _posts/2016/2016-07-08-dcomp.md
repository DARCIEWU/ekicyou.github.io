---
layout: post
title:  DirectCompositionを使ってみよう
comments: true
published: false
tags:
  - DirectComposition

---
### 目標を一言で言おう
　かっこいいエフェクトをシェルにかぶせたい！

### 伺か、ご存知ですか？
　伺かとは、かつて一世を風靡し、そして今もなお現役の
デスクトップマスコットプラットフォームです。
プラットフォームとしてSSPが有名ですね。
お手軽な手順に沿ってごにょごにょすれば、あら不思議！
あなたもデスクトップマスコット（ゴーストと呼ぶ）のデベロッパーです。

　この環境、基本的には立ち絵をいくつか用意してタイミング記述を
行えば紙芝居アニメーションが可能ですが、
超気合の入った人なら、Direct3Dとかぶっ叩いて
直接描画を行う試みも散見されます。

　これまでよく見られた方法としては、
メイン画像のウィンドウの前や後ろに
自分で作ったウィンドウをかぶせるような手法が一般的でした。

　今回ご紹介するのは、この合成方法としてWindows8.1より
正式サポートされた「DirectComposition」という道具を利用した、
もっとええ感じにシェルに
エフェクトを突っ込んでやろうという試みを行います。

### 理屈は省く
　DirectCompositionというものをぶっちゃけ説明すれば、
GDIで描画されたウィンドウの前面・背面それぞれに、
Direct3Dで描画したなんやかんやを重ねて表示してくれる機能です。原理とか置いといて、大事な事なので言い直します。

　「ウィンドウのGDI描画に対して、【前面】【背面】それぞれに2D画像を
用意したら、３つ合わせて合成してくれる。」のがDirectCompositionです。

　Direct3Dで頑張って2D画像を作れば、
最後の合成はこの子に任せちゃえばいいのです。
往年のFM TOWNSを彷彿とさせるスプライト合成機能が
割とこっそり最新Windowsに搭載されている事実に、
オッサン、涙を拭かずにいられません。










